---
title: "3D Single-Stage Model Training"
date: 2024-09-18 17:54:36
categories:
  - 프로젝트
---

```
[DICOM 이미지들] -> [3D 포인트 클라우드] -> [3D 복셀 그리드]
      |                    |                   |
      V                    V                   V
  +-------+           +-------+           +-------+
  |  □□□  |           | •  •  |           |███████|
  |  □□□  |    ->     |•  •  •|    ->     |███████|
  |  □□□  |           | •  •  |           |███████|
  +-------+           +-------+           +-------+
  여러 2D 슬라이스    3D 포인트 집합      규칙적인 3D 그리드
```

```
T1 시리즈        T2 시리즈        T2/STIR 시리즈
+-------+        +-------+        +-------+
|███████|        |███████|        |███████|
|███████|   +    |███████|   +    |███████|   =   최종 3D 모델
|███████|        |███████|        |███████|
+-------+        +-------+        +-------+
```

최종적으로, 모든 이미지(100장이든 그 이상이든)의 정보가 하나의 일관된 3D 모델로 통합됩니다.

이 3D 모델은 원본 이미지들의 모든 정보를 포함하며, 각 부분이 3D 공간에서 정확한 위치에 있습니다.

grid = np.zeros((3, img\_size[0], img\_size[0], img\_size[0]), dtype=np.float16)

(3, D, H, W)

<https://claude.ai/chat/219a0bbd-6dd6-4010-960e-d42e84d1545e>

[Claude](https://claude.ai/chat/219a0bbd-6dd6-4010-960e-d42e84d1545e)

```
[입력 3D 이미지]
       |
       v
[전처리 (정규화, 패딩)]
       |
       v
[3D Backbone (EfficientNet 또는 ViT)]
       |
       v
[특징 벡터]
       |
       +------------+------------+------------+
       |            |            |            |
       v            v            v            v
   [헤드 1]      [헤드 2]      [헤드 3]  ...  [헤드 N]
       |            |            |            |
       v            v            v            v
[LogisticCumulativeLink (순서형 분류)]
       |            |            |            |
       v            v            v            v
  [출력 1]      [출력 2]      [출력 3]  ...  [출력 N]
```

```
[train_model_with_validation 함수]
        |
        v
[초기화 및 설정]
        |
        v
[에포크 루프]
    |
    +--->[훈련 단계]
    |       |
    |       +-->[데이터 로딩]
    |       |
    |       +-->[순전파]
    |       |
    |       +-->[손실 계산]
    |       |
    |       +-->[역전파 및 최적화]
    |
    +--->[검증 단계]
    |       |
    |       +-->[model_validation_loss 함수 호출]
    |               |
    |               +-->[검증 데이터에 대한 예측]
    |               |
    |               +-->[다양한 손실 계산]
    |
    +--->[모델 저장]
    |
    +--->[학습률 조정]
    |
    +--->[결과 시각화]
```

```
[손실 함수 설정]
        |
        v
[K-폴드 루프]
    |
    +--->[모델 초기화]
    |
    +--->[옵티마이저 설정]
    |
    +--->[데이터 로더 설정]
    |
    +--->[모델 훈련 및 검증]
```
